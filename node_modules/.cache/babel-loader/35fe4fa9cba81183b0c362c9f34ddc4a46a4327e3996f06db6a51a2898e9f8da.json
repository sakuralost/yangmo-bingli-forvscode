{"ast":null,"code":"var _jsxFileName = \"F:\\\\Users\\\\\\u8FF7\\u5931\\u5C0F\\u7237\\\\\\u6587\\u6863\\\\Aicoder\\\\vscode\\\\bingli\\\\medical-record-assistant\\\\src\\\\pages\\\\HomePage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport RecordList from '../components/RecordList';\nimport { fetchRecords } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ADMIN_PASSWORD = 'yangmo'; // 管理员密码\n\nconst HomePage = () => {\n  _s();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [records, setRecords] = useState([]);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [loadError, setLoadError] = useState(null);\n\n  // 验证管理员密码\n  const handleLogin = () => {\n    if (password === ADMIN_PASSWORD) {\n      setIsAuthenticated(true);\n      setError('');\n      // 将认证状态保存在 sessionStorage 中，这样刷新页面时不需要重新输入密码\n      sessionStorage.setItem('isAuthenticated', 'true');\n    } else {\n      setError('密码错误');\n    }\n    setPassword('');\n  };\n\n  // 检查是否已经认证\n  useEffect(() => {\n    const auth = sessionStorage.getItem('isAuthenticated');\n    if (auth === 'true') {\n      setIsAuthenticated(true);\n    }\n  }, []);\n\n  // 加载病例数据\n  const loadRecords = async () => {\n    setIsLoading(true);\n    setLoadError(null);\n    try {\n      const fetchedRecords = await fetchRecords();\n      setRecords(fetchedRecords);\n    } catch (error) {\n      setLoadError(error instanceof Error ? error.message : '加载病例数据失败');\n      console.error('加载病例数据失败:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // 监听认证状态和路由变化，重新加载数据\n  useEffect(() => {\n    if (isAuthenticated) {\n      loadRecords();\n    }\n  }, [isAuthenticated, location.key]); // 添加 location.key 作为依赖项\n\n  // 跳转到新增病例页面\n  const handleAddNewRecord = () => {\n    navigate('/patient');\n  };\n\n  // 如果未认证，显示登录界面\n  if (!isAuthenticated) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"login-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"\\u6768\\u58A8\\u75C5\\u4F8B\\u7BA1\\u7406\\u7CFB\\u7EDF\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"login-form\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"password\",\n          value: password,\n          onChange: e => setPassword(e.target.value),\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u7BA1\\u7406\\u5458\\u5BC6\\u7801\",\n          onKeyPress: e => e.key === 'Enter' && handleLogin()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleLogin,\n          children: \"\\u767B\\u5F55\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 21\n        }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"error-message\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 31\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }, this);\n  }\n\n  // 已认证，显示主界面\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"app-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"\\u6768\\u58A8\\u75C5\\u4F8B\\u7BA1\\u7406\\u7CFB\\u7EDF\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"add-record-button\",\n        onClick: handleAddNewRecord,\n        children: \"\\u65B0\\u589E\\u75C5\\u4F8B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"main-content\",\n      children: [isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading\",\n        children: \"\\u6B63\\u5728\\u52A0\\u8F7D\\u6570\\u636E...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 31\n      }, this), loadError && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: [loadError, /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => window.location.reload(),\n          children: \"\\u91CD\\u8BD5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 21\n      }, this), !isLoading && !loadError && /*#__PURE__*/_jsxDEV(RecordList, {\n        records: records\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 46\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 9\n  }, this);\n};\n_s(HomePage, \"RrgwAXw18fFftmbfhs0jcRReOu8=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = HomePage;\nexport default HomePage;\nvar _c;\n$RefreshReg$(_c, \"HomePage\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useLocation","RecordList","fetchRecords","jsxDEV","_jsxDEV","ADMIN_PASSWORD","HomePage","_s","navigate","location","records","setRecords","isAuthenticated","setIsAuthenticated","password","setPassword","error","setError","isLoading","setIsLoading","loadError","setLoadError","handleLogin","sessionStorage","setItem","auth","getItem","loadRecords","fetchedRecords","Error","message","console","key","handleAddNewRecord","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","value","onChange","e","target","placeholder","onKeyPress","onClick","window","reload","_c","$RefreshReg$"],"sources":["F:/Users/迷失小爷/文档/Aicoder/vscode/bingli/medical-record-assistant/src/pages/HomePage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport RecordList from '../components/RecordList';\nimport { fetchRecords } from '../services/api';\nimport { Record } from '../types';\n\nconst ADMIN_PASSWORD = 'yangmo'; // 管理员密码\n\nconst HomePage: React.FC = () => {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const [records, setRecords] = useState<Record[]>([]);\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\n    const [password, setPassword] = useState('');\n    const [error, setError] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const [loadError, setLoadError] = useState<string | null>(null);\n\n    // 验证管理员密码\n    const handleLogin = () => {\n        if (password === ADMIN_PASSWORD) {\n            setIsAuthenticated(true);\n            setError('');\n            // 将认证状态保存在 sessionStorage 中，这样刷新页面时不需要重新输入密码\n            sessionStorage.setItem('isAuthenticated', 'true');\n        } else {\n            setError('密码错误');\n        }\n        setPassword('');\n    };\n\n    // 检查是否已经认证\n    useEffect(() => {\n        const auth = sessionStorage.getItem('isAuthenticated');\n        if (auth === 'true') {\n            setIsAuthenticated(true);\n        }\n    }, []);\n\n    // 加载病例数据\n    const loadRecords = async () => {\n        setIsLoading(true);\n        setLoadError(null);\n        try {\n            const fetchedRecords = await fetchRecords();\n            setRecords(fetchedRecords);\n        } catch (error) {\n            setLoadError(error instanceof Error ? error.message : '加载病例数据失败');\n            console.error('加载病例数据失败:', error);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // 监听认证状态和路由变化，重新加载数据\n    useEffect(() => {\n        if (isAuthenticated) {\n            loadRecords();\n        }\n    }, [isAuthenticated, location.key]); // 添加 location.key 作为依赖项\n\n    // 跳转到新增病例页面\n    const handleAddNewRecord = () => {\n        navigate('/patient');\n    };\n\n    // 如果未认证，显示登录界面\n    if (!isAuthenticated) {\n        return (\n            <div className=\"login-container\">\n                <h2>杨墨病例管理系统</h2>\n                <div className=\"login-form\">\n                    <input\n                        type=\"password\"\n                        value={password}\n                        onChange={(e) => setPassword(e.target.value)}\n                        placeholder=\"请输入管理员密码\"\n                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}\n                    />\n                    <button onClick={handleLogin}>登录</button>\n                    {error && <p className=\"error-message\">{error}</p>}\n                </div>\n            </div>\n        );\n    }\n\n    // 已认证，显示主界面\n    return (\n        <div className=\"home-page\">\n            <header className=\"app-header\">\n                <h1>杨墨病例管理系统</h1>\n                <button\n                    className=\"add-record-button\"\n                    onClick={handleAddNewRecord}\n                >\n                    新增病例\n                </button>\n            </header>\n\n            <main className=\"main-content\">\n                {isLoading && <div className=\"loading\">正在加载数据...</div>}\n                {loadError && (\n                    <div className=\"error-message\">\n                        {loadError}\n                        <button onClick={() => window.location.reload()}>重试</button>\n                    </div>\n                )}\n                {!isLoading && !loadError && <RecordList records={records} />}\n            </main>\n        </div>\n    );\n};\n\nexport default HomePage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}